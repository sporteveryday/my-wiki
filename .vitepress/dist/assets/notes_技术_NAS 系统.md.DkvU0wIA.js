import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.CQuhCYrb.js";const k=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"notes/技术/NAS 系统.md","filePath":"notes/技术/NAS 系统.md","lastUpdated":1764827213000}'),l={name:"notes/技术/NAS 系统.md"};function e(o,s,r,h,p,d){return t(),a("div",null,[...s[0]||(s[0]=[n(`<p>利用闲置 Windows 电脑通过虚拟机搭建 NAS 系统是一个非常经济且实用的方案，适合入门体验、数据备份和家庭媒体中心。</p><p>以下是一套完整的实施方案，采用目前<strong>兼容性最好、操作相对简单且功能强大</strong>的组合：<strong>VMware Workstation Pro (宿主软件) + 黑群晖 DSM 7.x (NAS系统)</strong>。</p><hr><h3 id="方案概览" tabindex="-1">方案概览 <a class="header-anchor" href="#方案概览" aria-label="Permalink to &quot;方案概览&quot;">​</a></h3><ul><li><strong>宿主系统</strong>：Windows 10/11 (建议专业版，但也支持家庭版)</li><li><strong>虚拟化软件</strong>：VMware Workstation Pro (目前对个人用户已免费)</li><li><strong>NAS 系统</strong>：群晖 DSM 7.2 (使用 RR 或 ARPL 引导)</li><li><strong>核心优势</strong>：无需重装电脑系统，Windows 可继续做主力机或跑其他服务，硬盘直通可保证数据独立性。</li></ul><hr><h3 id="第一阶段-硬件与环境准备" tabindex="-1">第一阶段：硬件与环境准备 <a class="header-anchor" href="#第一阶段-硬件与环境准备" aria-label="Permalink to &quot;第一阶段：硬件与环境准备&quot;">​</a></h3><ol><li><strong>BIOS 设置 (必须)</strong>： <ul><li>重启电脑进入 BIOS，开启 <strong>虚拟化技术 (Intel VT-x 或 AMD-V)</strong>。</li></ul></li><li><strong>硬盘规划 (关键)</strong>： <ul><li><strong>系统盘</strong>：Windows 和 虚拟机软件安装在电脑原本的 SSD 上。</li><li><strong>数据盘</strong>：强烈建议准备<strong>一块独立的物理硬盘</strong>（机械或固态均可）专门用于 NAS 存储。 <ul><li><em>注意：如果只有一块硬盘，只能用虚拟磁盘文件，但数据安全性较差，重装 Windows 容易丢失数据。</em></li></ul></li></ul></li><li><strong>网络环境</strong>： <ul><li>建议使用<strong>网线</strong>连接路由器，Wi-Fi 不稳定且速度慢，不适合 NAS 传输。</li></ul></li></ol><hr><h3 id="第二阶段-软件安装" tabindex="-1">第二阶段：软件安装 <a class="header-anchor" href="#第二阶段-软件安装" aria-label="Permalink to &quot;第二阶段：软件安装&quot;">​</a></h3><h4 id="_1-下载并安装-vmware-workstation-pro" tabindex="-1">1. 下载并安装 VMware Workstation Pro <a class="header-anchor" href="#_1-下载并安装-vmware-workstation-pro" aria-label="Permalink to &quot;1. 下载并安装 VMware Workstation Pro&quot;">​</a></h4><ul><li>去博通 (Broadcom) 官网或可靠资源站下载 VMware Workstation Pro 17.x 版本。</li><li>选择“个人用途”安装，现已免费。</li></ul><h4 id="_2-准备群晖引导文件-bootloader" tabindex="-1">2. 准备群晖引导文件 (Bootloader) <a class="header-anchor" href="#_2-准备群晖引导文件-bootloader" aria-label="Permalink to &quot;2. 准备群晖引导文件 (Bootloader)&quot;">​</a></h4><ul><li><strong>推荐工具</strong>：使用 <code>RR (RedPill-RR)</code> 或 <code>ARC</code> 引导。</li><li><strong>下载地址</strong>：去 GitHub 搜索 <code>RR</code> 或 <code>AuxXxilium/arc</code> 下载最新镜像（通常是 <code>.img</code> 格式）。</li><li><strong>转换格式</strong>：使用 StarWind V2V Converter 将 <code>.img</code> 文件转换为 VMware 支持的 <code>.vmdk</code> 格式。</li></ul><hr><h3 id="第三阶段-虚拟机搭建-核心步骤" tabindex="-1">第三阶段：虚拟机搭建 (核心步骤) <a class="header-anchor" href="#第三阶段-虚拟机搭建-核心步骤" aria-label="Permalink to &quot;第三阶段：虚拟机搭建 (核心步骤)&quot;">​</a></h3><h4 id="_1-创建虚拟机" tabindex="-1">1. 创建虚拟机 <a class="header-anchor" href="#_1-创建虚拟机" aria-label="Permalink to &quot;1. 创建虚拟机&quot;">​</a></h4><ol><li>打开 VMware，点击 <strong>&quot;创建新的虚拟机&quot;</strong> -&gt; <strong>&quot;自定义 (高级)&quot;</strong>。</li><li><strong>兼容性</strong>：默认即可 (Workstation 17.x)。</li><li><strong>安装来源</strong>：选择 <strong>&quot;稍后安装操作系统&quot;</strong>。</li><li><strong>操作系统</strong>：选择 <strong>Linux</strong>，版本选择 <strong>Linux 5.x kernel 64-bit</strong> (或其他 Linux 64位)。</li><li><strong>命名</strong>：例如 &quot;NAS-DSM&quot;。</li><li><strong>处理器/内存</strong>：建议分配 2核 CPU，4GB 内存 (根据你电脑配置调整，至少 2GB)。</li><li><strong>网络类型</strong>：<strong>非常重要</strong>，选择 <strong>&quot;使用桥接网络&quot; (Bridged)</strong>。这样 NAS 会有独立的局域网 IP，和路由器下的其他设备平级。</li></ol><h4 id="_2-配置引导盘" tabindex="-1">2. 配置引导盘 <a class="header-anchor" href="#_2-配置引导盘" aria-label="Permalink to &quot;2. 配置引导盘&quot;">​</a></h4><ol><li>创建完成后，<strong>不要启动</strong>。</li><li>编辑虚拟机设置，<strong>删除</strong>默认创建的那个 SCSI 硬盘和 CD/DVD 光驱（可选）。</li><li>点击 <strong>&quot;添加&quot;</strong> -&gt; <strong>&quot;硬盘&quot;</strong> -&gt; <strong>&quot;SATA&quot;</strong> (选 SATA 兼容性好) -&gt; <strong>&quot;使用现有虚拟磁盘&quot;</strong>。</li><li>浏览选择你刚才转换好的 <strong>引导文件 (.vmdk)</strong>。</li></ol><h4 id="_3-配置数据盘-推荐-物理硬盘直通" tabindex="-1">3. 配置数据盘 (推荐：物理硬盘直通) <a class="header-anchor" href="#_3-配置数据盘-推荐-物理硬盘直通" aria-label="Permalink to &quot;3. 配置数据盘 (推荐：物理硬盘直通)&quot;">​</a></h4><p><em>这是为了保证数据安全，如果 Windows 挂了，这块硬盘拔下来插到别的 Linux 机器上也能读数据。</em></p><ol><li>在 Windows 磁盘管理中，确认你要直通的硬盘编号 (例如 <code>磁盘 1</code>)，并将其设为“脱机”状态。</li><li>VMware 虚拟机设置 -&gt; <strong>&quot;添加&quot;</strong> -&gt; <strong>&quot;硬盘&quot;</strong> -&gt; <strong>SATA/NVMe</strong>。</li><li>选择 <strong>&quot;使用物理磁盘&quot; (Use a physical disk)</strong>。</li><li>在下拉菜单中选择对应的 <code>PhysicalDrive1</code> (根据你的磁盘管理编号)。</li><li>完成添加。</li></ol><h4 id="_4-修改网络适配器" tabindex="-1">4. 修改网络适配器 <a class="header-anchor" href="#_4-修改网络适配器" aria-label="Permalink to &quot;4. 修改网络适配器&quot;">​</a></h4><ul><li>进入虚拟机安装目录，找到 <code>.vmx</code> 文件，用记事本打开。</li><li>确认 <code>ethernet0.virtualDev = &quot;e1000e&quot;</code> (如果不是，建议改为这个，兼容性好)。</li><li>在最后一行添加 <code>disk.EnableUUID = &quot;TRUE&quot;</code> (这对群晖识别硬盘很重要)。</li></ul><hr><h3 id="第四阶段-系统安装与初始化" tabindex="-1">第四阶段：系统安装与初始化 <a class="header-anchor" href="#第四阶段-系统安装与初始化" aria-label="Permalink to &quot;第四阶段：系统安装与初始化&quot;">​</a></h3><ol><li><strong>启动虚拟机</strong>：在 VMware 中开启虚拟机。</li><li><strong>编译引导</strong>： <ul><li>看到的将会是一个类似 DOS 的界面 (RR/ARC 菜单)。</li><li>选择 <code>Build the loader</code> (或者自动模式)，选择型号 (建议 <strong>DS918+</strong> 或 <strong>DS920+</strong>)，系统会自动识别并编译驱动。</li><li>编译完成后，选择 <code>Boot the loader</code>。</li></ul></li><li><strong>安装 DSM</strong>： <ul><li>等待 2-5 分钟。</li><li>在浏览器输入 <code>http://find.synology.com</code> 或者去路由器后台查看新设备的 IP 地址。</li><li>进入安装向导，选择 <strong>&quot;从计算机手动上传 .pat 文件&quot;</strong> (去群晖官网下载对应型号 DS918+ 的 7.2 系统包)。</li><li><strong>注意</strong>：不要开启自动更新系统。</li></ul></li></ol><hr><h3 id="第五阶段-必做配置与优化" tabindex="-1">第五阶段：必做配置与优化 <a class="header-anchor" href="#第五阶段-必做配置与优化" aria-label="Permalink to &quot;第五阶段：必做配置与优化&quot;">​</a></h3><ol><li><strong>固定 IP</strong>：在群晖控制面板 -&gt; 网络 -&gt; 网络界面，将 IP 设置为静态 (例如 192.168.1.200)，防止重启后 IP 变动。</li><li><strong>防止 Windows 休眠</strong>： <ul><li>宿主 Windows 必须设置为 <strong>&quot;从不睡眠&quot;</strong>。</li><li>建议开启 BIOS 中的 <strong>&quot;AC Power Recovery&quot;</strong> (来电自启)，并设置 Windows 自动登录 + 启动组里放入 VMware 自动启动脚本。</li></ul></li><li><strong>内网穿透 (实现外网访问)</strong>： <ul><li>由于是虚拟机，最简单的方案是安装 <strong>Tailscale</strong> 或 <strong>ZeroTier</strong> 套件 (群晖套件中心或 Docker 安装)。</li><li>如果有公网 IP，在路由器做端口映射 (5000/5001) 指向 NAS 的 IP。</li></ul></li></ol><hr><h3 id="替代方案-如果不喜欢群晖" tabindex="-1">替代方案：如果不喜欢群晖 <a class="header-anchor" href="#替代方案-如果不喜欢群晖" aria-label="Permalink to &quot;替代方案：如果不喜欢群晖&quot;">​</a></h3><p>如果你担心黑群晖的稳定性，或者想要更轻量/正版的方案：</p><p><strong>方案 B：CasaOS (基于 Linux)</strong></p><ol><li>VMware 安装 Ubuntu Server 22.04/24.04 (LTS)。</li><li>在 Ubuntu 里运行一行命令安装 CasaOS。</li><li><strong>优点</strong>：界面极简，Docker 管理方便，纯正 Linux 环境，轻量，稳定。</li></ol><p><strong>方案 C：TrueNAS Scale</strong></p><ol><li>VMware 直接安装 TrueNAS Scale ISO。</li><li><strong>优点</strong>：ZFS 文件系统数据最安全，开源免费。</li><li><strong>缺点</strong>：对内存要求高 (建议 8G+)，操作界面比较专业，不适合小白。</li></ol><hr><h3 id="总结与风险提示" tabindex="-1">总结与风险提示 <a class="header-anchor" href="#总结与风险提示" aria-label="Permalink to &quot;总结与风险提示&quot;">​</a></h3><ol><li><strong>性能损耗</strong>：Windows 本身占用资源，虚拟机 NAS 的磁盘读写速度大约是物理机安装的 80%-90%，但千兆局域网内基本跑满，无感知。</li><li><strong>稳定性</strong>：Windows Update 自动重启是最大的敌人。<strong>务必暂停或配置组策略禁止 Windows 自动重启更新</strong>。</li><li><strong>数据备份</strong>：虽然是 NAS，但建议重要数据定期冷备份到移动硬盘 (RAID 不是备份)。</li></ol><p>这套方案实施下来，你将拥有一台功能完整的 NAS，同时不影响原电脑的正常使用（上网、办公、看视频）。</p><p>这是一个非常明智的决定。<strong>Rocky Linux 9</strong> 和 <strong>AlmaLinux 9</strong> 都是 RHEL 9 (Red Hat Enterprise Linux 9) 的 1:1 下游发行版。</p><p>相比 CentOS 7，它们的优势在于：</p><ul><li><strong>内核更新</strong>：Linux Kernel 5.14+（更好的硬件兼容性和性能）。</li><li><strong>软件源</strong>：DNF 包管理器（比 Yum 更快更现代）。</li><li><strong>安全性</strong>：更现代的加密标准和 SELinux 策略。</li><li><strong>生命周期</strong>：支持到 2032 年，长期无忧。</li></ul><p>以下是基于 <strong>Rocky Linux 9 / AlmaLinux 9</strong> 的 Windows 虚拟机 NAS 实施方案。</p><hr><h3 id="第一阶段-准备工作" tabindex="-1">第一阶段：准备工作 <a class="header-anchor" href="#第一阶段-准备工作" aria-label="Permalink to &quot;第一阶段：准备工作&quot;">​</a></h3><ol><li><p><strong>下载镜像</strong>：</p><ul><li>访问 <a href="https://rockylinux.org/download" target="_blank" rel="noreferrer">Rocky Linux 官网</a> 或 <a href="https://almalinux.org/isos/" target="_blank" rel="noreferrer">AlmaLinux 官网</a>。</li><li><strong>推荐版本</strong>：<strong>Minimal ISO</strong> (x86_64)。同样不需要图形界面，体积小（约 1.5GB），开销低。</li></ul></li><li><p><strong>VMware 虚拟机配置</strong>：</p><ul><li><strong>创建</strong>：选“典型” -&gt; “稍后安装操作系统”。</li><li><strong>版本</strong>：选择 <strong>Red Hat Enterprise Linux 9 (64-bit)</strong> 或 <strong>Other Linux 5.x kernel 64-bit</strong>。</li><li><strong>配置</strong>： <ul><li><strong>CPU</strong>：2核。</li><li><strong>内存</strong>：建议 <strong>2GB - 4GB</strong>（EL9 比 CentOS 7 稍微吃一点内存，2GB 起步比较稳妥）。</li><li><strong>网络</strong>：务必选择 <strong>“桥接模式” (Bridged)</strong>。</li></ul></li></ul></li></ol><hr><h3 id="第二阶段-系统安装-el9-与-c7-的细微差别" tabindex="-1">第二阶段：系统安装 (EL9 与 C7 的细微差别) <a class="header-anchor" href="#第二阶段-系统安装-el9-与-c7-的细微差别" aria-label="Permalink to &quot;第二阶段：系统安装 (EL9 与 C7 的细微差别)&quot;">​</a></h3><ol><li><strong>启动安装</strong>： <ul><li>选择 <code>Install Rocky Linux 9</code> (或 AlmaLinux 9)。</li></ul></li><li><strong>语言</strong>：建议 English 或 中文。</li><li><strong>Installation Destination (磁盘)</strong>： <ul><li>选择系统盘，Storage Configuration 选 Automatic 即可。</li></ul></li><li><strong>Software Selection (软件)</strong>： <ul><li>确认是 <strong>Minimal Install</strong>。</li><li>右侧可以勾选 <strong>Guest Agents</strong> (优化 VMware 体验) 和 <strong>Standard</strong>。</li></ul></li><li><strong>Network &amp; Host Name (网络)</strong>： <ul><li><strong>重要</strong>：点击 Configure，设置 IPv4 为 Manual (静态 IP)，例如 <code>192.168.1.200</code>，网关 <code>192.168.1.1</code>。</li><li><strong>打开网卡开关</strong>，确保 Connected。</li></ul></li><li><strong>User Settings (用户)</strong>： <ul><li><strong>Root Password</strong>：设置 Root 密码（如果不勾选 &quot;Allow root SSH login with password&quot;，后面 SSH 会连不上 Root，建议勾选方便局域网管理）。</li><li><strong>User Creation</strong>：创建一个普通用户。</li></ul></li></ol><hr><h3 id="第三阶段-基础环境配置" tabindex="-1">第三阶段：基础环境配置 <a class="header-anchor" href="#第三阶段-基础环境配置" aria-label="Permalink to &quot;第三阶段：基础环境配置&quot;">​</a></h3><p>Rocky/Alma 9 使用 <code>dnf</code> 命令代替了 <code>yum</code>（虽然输入 yum 也能用，但在 9 里它是 dnf 的别名）。</p><ol><li><p><strong>SSH 登录</strong>：<br> 使用 Windows 终端或 Putty/Xshell 登录你的 IP。</p></li><li><p><strong>更新系统</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dnf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div></li><li><p><strong>安装基础工具</strong>：<br><em>注意：EL9 默认不再安装 <code>ifconfig</code>，改用 <code>ip addr</code>。如果想要旧命令，需安装 <code>net-tools</code>。</em></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dnf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net-tools</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> epel-release</span></span></code></pre></div></li><li><p><strong>检查网络</strong> (如果在安装时没设好静态 IP)：<br> EL9 推荐使用 <code>nmtui</code> (图形化终端界面) 修改网络，比改文件方便得多。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmtui</span></span></code></pre></div><ul><li><code>Edit a connection</code> -&gt; 选中网卡 -&gt; IPv4 <code>Manual</code> -&gt; 填写 -&gt; OK -&gt; Back -&gt; <code>Activate a connection</code> (停用再启用以生效)。</li></ul></li></ol><hr><h3 id="第四阶段-挂载数据盘-存储核心" tabindex="-1">第四阶段：挂载数据盘 (存储核心) <a class="header-anchor" href="#第四阶段-挂载数据盘-存储核心" aria-label="Permalink to &quot;第四阶段：挂载数据盘 (存储核心)&quot;">​</a></h3><p>和 CentOS 7 逻辑一致，但文件系统依然推荐 <strong>XFS</strong>。</p><ol><li><p><strong>查看磁盘</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsblk</span></span></code></pre></div><p>假设新加入的数据盘是 <code>/dev/sdb</code>。</p></li><li><p><strong>格式化与挂载</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkfs.xfs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/sdb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/sdb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data</span></span></code></pre></div></li><li><p><strong>开机自动挂载</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取 UUID</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blkid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/sdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑 fstab</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/fstab</span></span></code></pre></div><p>添加：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UUID=你的UUID值  /data  xfs  defaults  0  0</span></span></code></pre></div><p>测试：<code>mount -a</code> (如果没报错说明成功)。</p></li></ol><hr><h3 id="第五阶段-部署-samba-服务-文件共享" tabindex="-1">第五阶段：部署 Samba 服务 (文件共享) <a class="header-anchor" href="#第五阶段-部署-samba-服务-文件共享" aria-label="Permalink to &quot;第五阶段：部署 Samba 服务 (文件共享)&quot;">​</a></h3><p><strong>注意：EL9 的安全性较高，SELinux 默认开启且严格。</strong> 这是新手最容易翻车的地方（能连上但无权限访问）。</p><ol><li><p><strong>安装 Samba</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dnf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> samba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> samba-common</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> samba-client</span></span></code></pre></div></li><li><p><strong>配置共享文件夹</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/share</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 777</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/share</span></span></code></pre></div></li><li><p><strong>配置 smb.conf</strong>：<br><code>vim /etc/samba/smb.conf</code><br> 在文件末尾添加：</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[NAS_Share]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = /data/share</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        browsable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = yes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        writable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = yes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        guest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = no</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        valid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = nasuser</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        create </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 0775</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        directory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 0775</span></span></code></pre></div></li><li><p><strong>添加用户</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useradd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nasuser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">smbpasswd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nasuser</span></span></code></pre></div></li><li><p><strong>关键步骤：处理 SELinux 和 防火墙</strong></p><ul><li><p><strong>方法一（推荐）：设置正确的 SELinux 上下文</strong><br> 如果你想保持安全，告诉 SELinux 这个目录是用来共享的：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置上下文</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chcon</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> samba_share_t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/share</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 放行防火墙</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-service=samba</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre></div></li><li><p><strong>方法二（偷懒）：将 SELinux 设为宽容模式</strong><br> 如果你不想折腾权限问题：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/selinux/config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 关闭防火墙 (仅限内网安全环境)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewalld</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewalld</span></span></code></pre></div></li></ul></li><li><p><strong>启动服务</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> smb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nmb</span></span></code></pre></div></li></ol><p>此时，Windows 应该可以访问 <code>\\\\192.168.x.x</code> 了。</p><hr><h3 id="第六阶段-现代化管理面板-cockpit" tabindex="-1">第六阶段：现代化管理面板 (Cockpit) <a class="header-anchor" href="#第六阶段-现代化管理面板-cockpit" aria-label="Permalink to &quot;第六阶段：现代化管理面板 (Cockpit)&quot;">​</a></h3><p><strong>Cockpit 是 Rocky/Alma 9 自带的官方 Web 管理界面，极其好用。</strong></p><ol><li><p><strong>启用 Cockpit</strong>：<br> EL9 通常预装了 Cockpit 核心，只需启用：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cockpit.socket</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 确保防火墙放行 (如果防火墙开着)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-service=cockpit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre></div></li><li><p><strong>安装文件共享插件</strong> (可选，用于图形化管理 Samba)：<br> 45Drives 开发了一个很好的 Cockpit 插件，可以图形化管理 Samba 和 NFS。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/45Drives/cockpit-file-sharing/releases/download/v3.3.4/cockpit-file-sharing-3.3.4-1.el8.noarch.rpm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dnf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./cockpit-file-sharing-3.3.4-1.el8.noarch.rpm</span></span></code></pre></div><p><em>(注：虽然文件名写着 el8，但在 el9 上通常兼容，或者直接去该项目 GitHub 找最新版)</em></p></li><li><p><strong>访问</strong>：<br> 浏览器打开 <code>https://&lt;NAS-IP&gt;:9090</code>。<br> 使用系统的 <code>root</code> 或 <code>nasuser</code> 账号登录。<br> 你可以看到 CPU、内存、磁盘、网络流量图，甚至网页版的 Terminal。</p></li></ol><hr><h3 id="第七阶段-安装-docker-可选-用于跑-jellyfin-等" tabindex="-1">第七阶段：安装 Docker (可选，用于跑 Jellyfin 等) <a class="header-anchor" href="#第七阶段-安装-docker-可选-用于跑-jellyfin-等" aria-label="Permalink to &quot;第七阶段：安装 Docker (可选，用于跑 Jellyfin 等)&quot;">​</a></h3><p>Rocky/Alma 9 默认推崇 <code>Podman</code>，但如果你习惯 Docker，安装步骤如下：</p><ol><li><p><strong>添加 Docker 源</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dnf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config-manager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://download.docker.com/linux/centos/docker-ce.repo</span></span></code></pre></div></li><li><p><strong>安装 Docker</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dnf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd.io</span></span></code></pre></div></li><li><p><strong>启动</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span></code></pre></div></li><li><p><strong>安装 CasaOS (可选)</strong>：<br> 如果你想要群晖那样的应用界面：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.casaos.io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span></code></pre></div></li></ol><h3 id="总结方案优势" tabindex="-1">总结方案优势 <a class="header-anchor" href="#总结方案优势" aria-label="Permalink to &quot;总结方案优势&quot;">​</a></h3><ol><li><strong>稳定性</strong>：Rocky/Alma 9 是企业级系统，极其稳定。</li><li><strong>可视化</strong>：利用 <strong>Cockpit</strong>，你拥有了原生的、消耗资源极低的可视化监控。</li><li><strong>扩展性</strong>：基于 Docker，可以安装 Nextcloud (私有云盘)、Jellyfin (影音库)、Transmission (下载)。</li><li><strong>维护</strong>：<code>dnf update</code> 即可保持系统安全更新。</li></ol><p>这个方案比 CentOS 7 更面向未来，且比黑群晖更透明、可控。</p>`,76)])])}const c=i(l,[["render",e]]);export{k as __pageData,c as default};
